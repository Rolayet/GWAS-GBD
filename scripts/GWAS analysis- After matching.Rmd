---
title: "GWAS analysis- After matching"
output: html_notebook
---


```{r}
library(dplyr)
library(data.table)
library(tidyr)
library(stringr)
library(ggplot2)
library(stats)
library(readr)
library(readxl)
library(openxlsx)
  
```


read the data 

```{r}

combined_dataset <- fread("/Users/rayanaloliet/Desktop/GWAS Catalog/combined_dataset_ncase.csv")

```


exclude GBD teams that are classified as Injuries

```{r}

# List of injuries to exclude
terms_to_exclude <- c("Injuries", "Transport injuries", "Road injuries", 
                         "Pedestrian road injuries", "Cyclist road injuries", 
                         "Motorcyclist road injuries", "Motor vehicle road injuries", 
                         "Other road injuries", "Other transport injuries", 
                         "Unintentional injuries", "Falls", "Drowning", 
                         "Fire, heat, and hot substances", "Poisonings", 
                         "Poisoning by carbon monoxide", "Poisoning by other means", 
                         "Exposure to mechanical forces", "Unintentional firearm injuries", 
                         "Other exposure to mechanical forces", "Adverse effects of medical treatment", 
                         "Animal contact", "Venomous animal contact", 
                         "Non-venomous animal contact", "Foreign body", 
                         "Pulmonary aspiration and foreign body in airway", 
                         "Foreign body in eyes", "Foreign body in other body part", 
                         "Environmental heat and cold exposure", "Exposure to forces of nature", 
                         "Other unintentional injuries", "Self-harm and interpersonal violence", 
                         "Self-harm", "Self-harm by firearm", "Self-harm by other specified means", 
                         "Interpersonal violence", "Physical violence by firearm", 
                         "Physical violence by sharp object", "Sexual violence", 
                         "Physical violence by other means", "Conflict and terrorism", 
                         "Police conflict and executions", "All causes")

 # Filter the GBD DALY data for "Number" metric and rename columns
filtered_dataset <- combined_dataset %>%
  filter(!(`GBD term` %in% terms_to_exclude))  # Exclude specified terms


```


read the data - other file from the GBD for terms classification

```{r}
broader_categories_dataset<- read_xlsx("/Users/rayanaloliet/Desktop/untitled folder 7/GBD_2021_CAUSE_HIERARCHY_Y2024M05D16.xlsx")
 
head(broader_categories_dataset)
```

check the numbers before the merging 

```{r}
# Calculate the sum of the column
total_sum <- sum(filtered_dataset$total_attention_score, na.rm = TRUE)

# Print the result
print(total_sum)
```

Rename `GBD term` to `Cause Name` in filtered_dataset for merging

```{r}
filtered_dataset <- filtered_dataset %>%
  rename(`Cause Name` = `GBD term`)
```


 Merge the datasets on `Cause Name`

```{r}
merged_dataset <- merge(filtered_dataset, broader_categories_dataset, by = "Cause Name", all.x = TRUE)
```

Summarize the total_attention_score by Parent Name (broader category)

```{r}
summarized_data <- merged_dataset %>%
  group_by(`Parent Name`) %>%
  summarise(total_attention_score = sum(total_attention_score, na.rm = TRUE), .groups = 'drop') %>%
  rename(Category_2 = `Parent Name`)
```


check the numbers after for the merging 

```{r}
# Calculate the sum of the column
total_sum <- sum(summarized_data$total_attention_score, na.rm = TRUE)

# Print the result
print(total_sum)
```

Create a bubble plot


```{r}
bubble_plot <- ggplot(summarized_data, aes(x = Category_2, y = total_attention_score, size = total_attention_score, label = Category_2)) +
  geom_point(alpha = 0.7, color = "skyblue") +
  geom_text(vjust = 1.5, size = 3.5) +
  theme_minimal() +
  labs(title = "Bubble Plot of Total Attention Score by Broader Category",
       x = "Broader Category",
       y = "Total Attention Score",
       size = "Total Attention Score") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

bubble_plot
```

Define the thresholds 

```{r}
# Define the thresholds for the categories
quantiles <- quantile(summarized_data$total_attention_score, probs = c(0, 0.25, 0.5, 0.75, 1))

# Categorize the scores
summarized_data <- summarized_data %>%
  mutate(category = case_when(
    total_attention_score <= quantiles[2] ~ "Very Low",
    total_attention_score <= quantiles[3] ~ "Low",
    total_attention_score <= quantiles[4] ~ "Medium",
    TRUE ~ "High"
  ))

```


plot for each category

```{r}

# Function to create bubble plots for each category
create_bubble_plot <- function(data, category) {
  ggplot(data, aes(x = Category_2, y = total_attention_score, size = total_attention_score, label = Category_2)) +
    geom_point(alpha = 0.7, color = "skyblue") +
    geom_text(vjust = 1.5, size = 3.5) +
    theme_minimal() +
    labs(title = paste("Bubble Plot of Total Attention Score -", category),
         x = "Broader Category",
         y = "Total Attention Score",
         size = "Total Attention Score") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

# Create and save bubble plots for each category
categories <- unique(summarized_data$category)
for (cat in categories) {
  cat_data <- summarized_data %>% filter(category == cat)
  bubble_plot <- create_bubble_plot(cat_data, cat)
  print(bubble_plot)
  ggsave(paste0("bubble_plot_", tolower(cat), ".png"), plot = bubble_plot, width = 12, height = 8)
}
```
Create a treemap


```{r}
treemap_plot <- ggplot(summarized_data, aes(area = total_attention_score, fill = category, label = Category_2)) +
  geom_treemap() +
  geom_treemap_text(fontface = "italic", colour = "white", place = "centre", grow = TRUE) +
  scale_fill_manual(values = c("Very Low" = "#FFDDC1", "Low" = "#FFABAB", "Medium" = "#FF6F91", "High" = "#FFC75F")) +
  theme_minimal() +
  labs(title = "Treemap of Total Attention Score by Category",
       fill = "Category") +
  theme(legend.position = "bottom")

 treemap_plot

```

bar plots 

```{r}
# Function to create bar plots for each category
create_bar_plot <- function(data, category) {
  ggplot(data, aes(x = reorder(Category_2, -total_attention_score), y = total_attention_score, fill = Category_2)) +
    geom_bar(stat = "identity") +
    coord_flip() +
    theme_minimal() +
    labs(title = paste("Bar Plot of Total Attention Score -", category),
         x = "Broader Category",
         y = "Total Attention Score") +
    theme(legend.position = "none",
          axis.text.y = element_text(size = 10))
}

# Create and save bar plots for each category
categories <- unique(summarized_data$category)
for (cat in categories) {
  cat_data <- summarized_data %>% filter(category == cat)
  bar_plot <- create_bar_plot(cat_data, cat)
  print(bar_plot)
  ggsave(paste0("bar_plot_", tolower(cat), ".png"), plot = bar_plot, width = 12, height = 8)
}

```


# Create a faceted bar plot

```{r}
faceted_bar_plot <- ggplot(summarized_data, aes(x = reorder(Category_2, total_attention_score), y = total_attention_score, fill = category)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  facet_wrap(~ category, scales = "free_y") +
  theme_minimal() +
  labs(title = "Faceted Bar Plot of Total Attention Score by Category",
       x = "Broader Category",
       y = "Total Attention Score",
       fill = "Category") +
  theme(axis.text.y = element_text(size = 8),
        strip.text = element_text(size = 10),
        legend.position = "none")

faceted_bar_plot
```

```{r}
# Define the thresholds for the categories (manual adjustment if needed)
thresholds <- quantile(summarized_data$total_attention_score, probs = c(0, 0.25, 0.5, 0.75, 1))
# For a more balanced categorization, you might manually adjust these thresholds.
# Example:
# thresholds <- c(0, 1000, 5000, 20000, Inf)

# Categorize the scores
summarized_data <- summarized_data %>%
  mutate(category = case_when(
    total_attention_score <= thresholds[2] ~ "Very Low",
    total_attention_score <= thresholds[3] ~ "Low",
    total_attention_score <= thresholds[4] ~ "Medium",
    TRUE ~ "High"
  ))

# Print the distribution of categories to debug
print(table(summarized_data$category))


```

# Function to create bar plots for each category

```{r}
create_separate_bar_plot <- function(data, category) {
  ggplot(data, aes(x = reorder(Category_2, total_attention_score), y = total_attention_score, fill = category)) +
    geom_bar(stat = "identity") +
    coord_flip() +
    theme_minimal() +
    labs(title = paste("Bar Plot of Total Attention Score -", category),
         x = "Broader Category",
         y = "Total Attention Score",
         fill = "Category") +
    theme(axis.text.y = element_text(size = 8),
          legend.position = "none")
}

 categories <- unique(summarized_data$category)
for (cat in categories) {
  cat_data <- summarized_data %>% filter(category == cat)
  bar_plot <- create_separate_bar_plot(cat_data, cat)
  print(bar_plot)
  ggsave(paste0("separate_bar_plot_", tolower(cat), ".png"), plot = bar_plot, width = 12, height = 8)
}


```

# Function to create lollipop charts for each category

```{r}
create_lollipop_chart <- function(data, category) {
  ggplot(data, aes(x = reorder(Category_2, total_attention_score), y = total_attention_score)) +
    geom_segment(aes(xend = Category_2, yend = 0), color = "skyblue") +
    geom_point(size = 4, color = "skyblue") +
    coord_flip() +
    theme_minimal() +
    labs(title = paste("Lollipop Chart of Total Attention Score -", category),
         x = "Broader Category",
         y = "Total Attention Score") +
    theme(axis.text.y = element_text(size = 8))
}

 categories <- unique(summarized_data$category)
for (cat in categories) {
  cat_data <- summarized_data %>% filter(category == cat)
  lollipop_chart <- create_lollipop_chart(cat_data, cat)
  print(lollipop_chart)
  ggsave(paste0("lollipop_chart_", tolower(cat), ".png"), plot = lollipop_chart, width = 12, height = 8)
}
```
```{r}
"#1f77b4"
"#2ca02c"
"#d62728"
"#ff7f0e"

"#FF9999", "#FFCC99",  "#99CCFF", "#6699CC"

# Create a custom color palette
color_palette <- c("Very Low" = "#FF9999", "Low" = "gray", "Medium" = "#FFCC99", "High" = "#6699CC")

# Create a faceted lollipop chart
faceted_lollipop_chart <- ggplot(summarized_data, aes(x = reorder(Category_2, total_attention_score), y = total_attention_score, color = category)) +
  geom_segment(aes(xend = Category_2, yend = 0), size = 1) +
  geom_point(size = 4) +
  coord_flip() +
  facet_wrap(~ category, scales = "free_y") +
  scale_color_manual(values = color_palette) +
  theme_minimal() +
  labs(title = "Total Attention Score by Hierarchy Level 2",
       x = "Health Conditions",
       y = "Total Attention Score",
       color = "Category") +
  theme(axis.text.y = element_text(size = 8),
        strip.text = element_text(size = 10))

# Display the faceted lollipop chart
print(faceted_lollipop_chart)
```
# Create a faceted grouped dot plot


```{r}
faceted_dot_plot <- ggplot(summarized_data, aes(x = reorder(Category_2, total_attention_score), y = total_attention_score, color = category)) +
  geom_point(size = 3) +
  coord_flip() +
  facet_wrap(~ category, scales = "free_y") +
  theme_minimal() +
  labs(title = "Faceted Dot Plot of Total Attention Score by Category",
       x = "Broader Category",
       y = "Total Attention Score",
       color = "Category") +
  theme(axis.text.y = element_text(size = 8),
        strip.text = element_text(size = 10),
        legend.position = "none")

faceted_dot_plot

```
threshold

```{r}
# Define the threshold for the categories
threshold <- median(summarized_data$total_attention_score)

# Categorize the scores into "High" and "Low"
summarized_data <- summarized_data %>%
  mutate(category = ifelse(total_attention_score > threshold, "High", "Low"))

# Define custom colors
custom_colors <- c("High" = "skyblue", "Low" = "salmon")

```



```{r}
# Function to create bar plots with names below the x-axis
create_bar_plot_names_below <- function(data, category) {
  ggplot(data, aes(x = reorder(Category_2, total_attention_score), y = total_attention_score, fill = category)) +
    geom_bar(stat = "identity", width = 1, color = "black") +  # Add borders to bars
    scale_fill_manual(values = custom_colors) +  # Use custom colors
    theme_minimal() +
    labs(title = paste("Bar Plot of Total Attention Score -", category),
         x = "Broader Category",
         y = "Total Attention Score",
         fill = "Category") +
    theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1, size = 10),  # Text below the axis
          axis.text.y = element_text(size = 8),
          legend.position = "none")
}

# Function to create bar plots with names above the x-axis
create_bar_plot_names_above <- function(data, category) {
  ggplot(data, aes(x = reorder(Category_2, total_attention_score), y = total_attention_score, fill = category)) +
    geom_bar(stat = "identity", width = 1, color = "black") +  # Add borders to bars
    scale_fill_manual(values = custom_colors) +  # Use custom colors
    theme_minimal() +
    labs(title = paste("Bar Plot of Total Attention Score -", category),
         x = "Broader Category",
         y = "Total Attention Score",
         fill = "Category") +
    theme(axis.text.x.top = element_text(angle = 90, vjust = 0, hjust = 0, size = 10),  # Text above the axis
          axis.text.y = element_text(size = 8),
          axis.title.x.top = element_blank(),
          legend.position = "none",
          axis.ticks.x = element_blank()) +
    scale_x_discrete(position = "top")
}

# Create and save bar plots for each category
categories <- unique(summarized_data$category)
for (cat in categories) {
  cat_data <- summarized_data %>% filter(category == cat)
  
  # Bar plot with names below the x-axis
  bar_plot_below <- create_bar_plot_names_below(cat_data, cat)
  print(bar_plot_below)
  ggsave(paste0("bar_plot_below_", tolower(cat), ".png"), plot = bar_plot_below, width = 14, height = 7)
  
  # Bar plot with names above the x-axis
  bar_plot_above <- create_bar_plot_names_above(cat_data, cat)
  print(bar_plot_above)
  ggsave(paste0("bar_plot_above_", tolower(cat), ".png"), plot = bar_plot_above, width = 14, height = 7)
}


```

```{r}
# Function to create bar plots for each category
create_separate_bar_plot <- function(data, category) {
  ggplot(data, aes(x = reorder(Category_2, total_attention_score), y = total_attention_score, fill = category)) +
    geom_bar(stat = "identity", width = 1, color = "black") +  # Add borders to bars
    scale_fill_manual(values = custom_colors) +  # Use custom colors
    theme_minimal() +
    labs(title = paste("Bar Plot of Total Attention Score -", category),
         x = "Broader Category",
         y = "Total Attention Score",
         fill = "Category") +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 10),  # Increase text size
          axis.text.y = element_text(size = 8),
          legend.position = "none")
}

# Create and save separate bar plots for each category
categories <- unique(summarized_data$category)
for (cat in categories) {
  cat_data <- summarized_data %>% filter(category == cat)
  bar_plot <- create_separate_bar_plot(cat_data, cat)
  print(bar_plot)
  ggsave(paste0("separate_bar_plot_", tolower(cat), ".png"), plot = bar_plot, width = 14, height = 7)
}

```



```{r}
# Create a faceted bar plot with separate panels for "High" and "Low" categories
faceted_bar_plot <- ggplot(summarized_data, aes(x = reorder(Category_2, total_attention_score), y = total_attention_score, fill = category)) +
  geom_bar(stat = "identity", width = 1, color = "black") +  # Add borders to bars
  scale_fill_manual(values = custom_colors) +  # Use custom colors
  facet_wrap(~ category, scales = "free") +  # Facet by category with free scales
  theme_minimal() +
  labs(title = "Faceted Bar Plot of Total Attention Score by Category",
       x = "Broader Category",
       y = "Total Attention Score",
       fill = "Category") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 10),  # Increase text size
        axis.text.y = element_text(size = 8),
        strip.text = element_text(size = 12),
        legend.position = "none")

# Display the faceted bar plot
print(faceted_bar_plot)

```
GWAS overall 

```{r}
# Visualize the distribution of 'total_attention_score'
ggplot(filtered_dataset, aes(x = total_attention_score)) +
  geom_histogram(binwidth = 500, fill = 'blue', color = 'black', alpha = 0.7) +
  labs(title = "Histogram of Total Attention Scores", x = "total_attention_score", y = "Frequency") +
  xlim(c(0, 35000))  


# Adding 1 to avoid log(0) which is undefined, for better visualization 
filtered_dataset$total_attention_score_log <- log10(filtered_dataset$total_attention_score + 1)

# Visualize the distribution with log transformation
ggplot(filtered_dataset, aes(x = total_attention_score_log)) +
  geom_histogram(binwidth = 0.1, fill = '#6699CC', color = 'black', alpha = 0.7) +
  labs(title = "Total Attention Scores In GWAS", 
       x = "Total Attention Scores", 
       y = "Frequency") +
  scale_x_continuous(breaks = seq(0, log10(max(filtered_dataset$total_attention_score + 1)), by = 1))




```



```{r}


merged_dataset <- merged_dataset %>%
  filter(substr(`Cause Outline`, 1, 1) %in% c("A", "B", "C", "D", "E", "F", "G", "H", "I"))

# Add descriptive labels for categories A and B
merged_dataset <- merged_dataset %>%
  mutate(Category_Label = case_when(
    substr(`Cause Outline`, 1, 1) == "A" ~ "Communicable, maternal, neonatal, and nutritional diseases",
    substr(`Cause Outline`, 1, 1) == "B" ~ "Non-communicable diseases"
  ))

# Sum the participants under each category label
Binary_data <- merged_dataset %>%
  group_by(Category_Label) %>%
  summarise(total_participants = sum(total_attention_score, na.rm = TRUE)) %>%
  ungroup()

#remove na
Binary_data <- na.omit(Binary_data)

```


```{r}
# Function to create bar chart
create_bar_chart <- function(data, title) {
  ggplot(data, aes(x = reorder(Category_Label, -total_participants), y = total_participants, fill = Category_Label)) +
    geom_bar(stat = "identity", position = "dodge") +
    theme_minimal() +
    labs(title = title,
         x = "Category",
         y = "Number of Participants") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
          legend.position = "none") + # Remove legend as labels are directly on the plot
    geom_text(aes(label = total_participants), vjust = -0.5, size = 4)
}

# Create and display bar chart for summed participants by category label
bar_chart <- create_bar_chart(Binary_data, "Number of Participants by Category (A and B)")

# Display the bar chart
print(bar_chart)
```



```{r}
# Donut Chart
donut_chart <- ggplot(Binary_data, aes(x = 2, y = -total_participants, fill = Category_Label)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar(theta = "y") +
  theme_void() +
  xlim(0.5, 2.5) +
  labs(title = "Total Attention Score by Hierarchy Level 1",
       fill = "Category") +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_text(aes(label = total_participants), position = position_stack(vjust = 0.5), size = 4)

# Display the donut chart
print(donut_chart)

Binary_data
```

```{r}

Binary_data <- data.frame(
  Category_Label = c("Communicable, maternal, neonatal, and nutritional diseases", "Non-communicable diseases"),
  total_participants = c(25783106, 335891674)
)

# Define custom colors
custom_colors <- c(
  "Communicable, maternal, neonatal, and nutritional diseases" = "#FF9999",
  "Non-communicable diseases" = "gray" 
)


library(ggplot2)

# Create the donut chart with custom colors and text labels
donut_chart <- ggplot(Binary_data, aes(x = 2, y = total_participants, fill = Category_Label)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar(theta = "y") +
  theme_void() +
  xlim(0.5, 2.5) +
  labs(title = "Total Attention Score by Hierarchy Level 1",
       fill = "Category") +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_text(aes(label = scales::comma(total_participants)), position = position_stack(vjust = 0.5), size = 4) +
  scale_fill_manual(values = custom_colors)  # Apply custom colors

# Display the donut chart
print(donut_chart)


```


```{r}
# Calculate the sum of the column
total_sum <- sum(filtered_dataset$total_attention_score, na.rm = TRUE)

# Print the result
print(total_sum)
```

```{r}
# Calculate the sum of the column
total_sum <- sum(Binary_data$total_participants, na.rm = TRUE)

# Print the result
print(total_sum)
```

# Load the GBD DALY data

```{r}


gbd_daly_data <- read_csv('/Users/rayanaloliet/Desktop/GWAS Catalog/IHME-GBD_2021_DATA-120ebfcd-1.csv')

# Filter out rows with NA values in the key columns
gbd_daly_data <- gbd_daly_data %>%
  filter(!is.na(`cause_name`), !is.na(val))

# Verify that there are no NA values left
sum(is.na(gbd_daly_data$`cause_name`))
sum(is.na(gbd_daly_data$val))
sum(is.na(gbd_daly_data$measure_name))

 
# Inspect the structure of the GBD DALY data
str(gbd_daly_data)
```


Merge the datasets

```{r}
#2021
gbd_daly_data <- gbd_daly_data %>%
  filter(metric_name == "Number") %>%
  rename(`GBD term`= cause_name, DALY = val)


# Merge the DALY values into the combined dataset
filtered_dataset <- filtered_dataset %>%
  left_join(gbd_daly_data, by = c("GBD term" = "GBD term"))



# Verify the merge
head(filtered_dataset)


# Verify the data
summary(filtered_dataset$total_attention_score)
summary(filtered_dataset$DALY)


# validate the merging 
filtered_dataset <- filtered_dataset %>%
  filter(!is.na(`GBD term`))

# Count the number of unique gbd terms
unique_gbd_terms <- n_distinct(filtered_dataset$`GBD term`)

# Print the number of unique gbd terms
unique_gbd_terms
```
Top 10 GBD Terms with Zero Total Attention Score Ranked by DALY
remove any parent names- to show specific diseases

```{r}


# List of terms to exclude
exclude_terms <- c(
  'All causes', 'Communicable, maternal, neonatal, and nutritional diseases', 
  'HIV/AIDS and sexually transmitted infections', 'HIV/AIDS', 
  'Sexually transmitted infections excluding HIV', 'Respiratory infections and tuberculosis', 
  'Tuberculosis', 'Enteric infections', 'Typhoid and paratyphoid', 
  'Neglected tropical diseases and malaria', 'Leishmaniasis', 
  'Intestinal nematode infections', 'Other infectious diseases', 
  'Acute hepatitis', 'Maternal and neonatal disorders', 'Maternal disorders', 
  'Neonatal disorders', 'Nutritional deficiencies', 'Non-communicable diseases', 
  'Neoplasms', 'Liver cancer', 'Non-melanoma skin cancer', 'Eye cancer', 
  'Non-Hodgkin lymphoma', 'Leukemia', 'Other neoplasms', 'Cardiovascular diseases', 
  'Stroke', 'Non-rheumatic valvular heart disease', 'Cardiomyopathy and myocarditis', 
  'Chronic respiratory diseases', 'Pneumoconiosis', 'Digestive diseases', 
  'Cirrhosis and other chronic liver diseases', 'Upper digestive system diseases', 
  'Neurological disorders', 'Headache disorders', 'Mental disorders', 
  'Depressive disorders', 'Eating disorders', 'Substance use disorders', 
  'Drug use disorders', 'Diabetes and kidney diseases', 'Diabetes mellitus', 
  'Chronic kidney disease', 'Skin and subcutaneous diseases', 'Dermatitis', 
  'Bacterial skin diseases', 'Sense organ diseases', 'Blindness and vision loss', 
  'Musculoskeletal disorders', 'Osteoarthritis', 'Other non-communicable diseases', 
  'Congenital birth defects', 'Urinary diseases and male infertility', 
  'Gynecological diseases', 'Hemoglobinopathies and hemolytic anemias', 
  'Oral disorders', 'Injuries', 'Transport injuries', 'Road injuries', 
  'Unintentional injuries', 'Poisonings', 'Exposure to mechanical forces', 
  'Animal contact', 'Foreign body', 'Self-harm and interpersonal violence', 
  'Self-harm', 'Interpersonal violence', 
  'Total cancers', 'Total burden related to hepatitis B', 
  'Total burden related to hepatitis C', 
  'Total burden related to Non-alcoholic fatty liver disease (NAFLD)', 
  'Total Cancers excluding Non-melanoma skin cancer'
)

# Filter the dataset to include only rows where total_attention_score is zero and exclude specific terms
filtered_zero_attention <- filtered_dataset %>%
  filter(total_attention_score == 0) %>%
  filter(!`GBD term` %in% exclude_terms)

# Get unique GBD terms and rank them based on DALY
unique_gbd_zero_attention <- filtered_zero_attention %>%
  distinct(`GBD term`, .keep_all = TRUE) %>%
  arrange(desc(DALY)) %>%
  head(10) # Take the top 10



```



```{r}
 
# Create a bubble plot
ggplot(unique_gbd_zero_attention, aes(x = `GBD term`, y = DALY, size = DALY)) +
  geom_point(alpha = 0.7, color = 'blue') +
  geom_text(aes(label = `GBD term`), vjust = 1.5, hjust = 0.5, color = "black", size = 2) +
  labs(title = "Top 10 GBD Terms with Zero Total Attention Score Ranked by DALY",
       x = NULL,
       y = "DALY") +
  theme_minimal() +
  theme(axis.text.x = element_blank(),  # Remove x-axis text
        axis.title.x = element_blank(), # Remove x-axis title
        axis.ticks.x = element_blank()) +
  scale_size_continuous(range = c(3, 15))

```
```{r}
library(ggrepel)

# Create a bubble plot
ggplot(unique_gbd_zero_attention, aes(x = `GBD term`, y = DALY, size = DALY)) +
  geom_point(alpha = 0.7, color = 'salmon') +
  geom_text_repel(aes(label = `GBD term`), size = 3, max.overlaps = Inf) +
  labs(title = "Top 10 GBD Terms with Zero Total Attention Score Ranked by DALY",
       x = NULL,
       y = "DALY") +
  theme_minimal() +
  theme(axis.text.x = element_blank(),  # Remove x-axis text
        axis.title.x = element_blank(), # Remove x-axis title
        axis.ticks.x = element_blank()) +
  scale_size_continuous(range = c(3, 15))



```


"Top 10 GBD Terms with Highest Total Attention Score Ranked by DALY

```{r}

# List of terms to exclude
exclude_terms <- c(
  'All causes', 'Communicable, maternal, neonatal, and nutritional diseases', 
  'HIV/AIDS and sexually transmitted infections', 'HIV/AIDS', 
  'Sexually transmitted infections excluding HIV', 'Respiratory infections and tuberculosis', 
  'Tuberculosis', 'Enteric infections', 'Typhoid and paratyphoid', 
  'Neglected tropical diseases and malaria', 'Leishmaniasis', 
  'Intestinal nematode infections', 'Other infectious diseases', 
  'Acute hepatitis', 'Maternal and neonatal disorders', 'Maternal disorders', 
  'Neonatal disorders', 'Nutritional deficiencies', 'Non-communicable diseases', 
  'Neoplasms', 'Liver cancer', 'Non-melanoma skin cancer', 'Eye cancer', 
  'Non-Hodgkin lymphoma', 'Leukemia', 'Other neoplasms', 'Cardiovascular diseases', 
  'Stroke', 'Non-rheumatic valvular heart disease', 'Cardiomyopathy and myocarditis', 
  'Chronic respiratory diseases', 'Pneumoconiosis', 'Digestive diseases', 
  'Cirrhosis and other chronic liver diseases', 'Upper digestive system diseases', 
  'Neurological disorders', 'Headache disorders', 'Mental disorders', 
  'Depressive disorders', 'Eating disorders', 'Substance use disorders', 
  'Drug use disorders', 'Diabetes and kidney diseases', 'Diabetes mellitus', 
  'Chronic kidney disease', 'Skin and subcutaneous diseases', 'Dermatitis', 
  'Bacterial skin diseases', 'Sense organ diseases', 'Blindness and vision loss', 
  'Musculoskeletal disorders', 'Osteoarthritis', 'Other non-communicable diseases', 
  'Congenital birth defects', 'Urinary diseases and male infertility', 
  'Gynecological diseases', 'Hemoglobinopathies and hemolytic anemias', 
  'Oral disorders', 'Injuries', 'Transport injuries', 'Road injuries', 
  'Unintentional injuries', 'Poisonings', 'Exposure to mechanical forces', 
  'Animal contact', 'Foreign body', 'Self-harm and interpersonal violence', 
  'Self-harm', 'Interpersonal violence', 
  'Total cancers', 'Total burden related to hepatitis B', 
  'Total burden related to hepatitis C', 
  'Total burden related to Non-alcoholic fatty liver disease (NAFLD)', 
  'Total Cancers excluding Non-melanoma skin cancer'
)

# Filter the dataset to exclude specific terms
filtered_high_attention <- filtered_dataset %>%
  filter(!`GBD term` %in% exclude_terms)

# Get unique GBD terms and rank them based on total_attention_score
unique_gbd_high_attention <- filtered_high_attention %>%
  distinct(`GBD term`, .keep_all = TRUE) %>%
  arrange(desc(total_attention_score)) %>%
  head(10) # Take the top 10

```



```{r}
# Create a bubble plot
ggplot(unique_gbd_high_attention, aes(x = `GBD term`, y = DALY, size = total_attention_score)) +
  geom_point(alpha = 0.7, color = 'skyblue') +
  geom_text_repel(aes(label = `GBD term`), size = 3, max.overlaps = Inf) +
  labs(title = "Top 10 GBD Terms with Highest Total Attention Score Ranked by DALY",
       x = NULL,
       y = "DALY") +
  theme_minimal() +
  theme(axis.text.x = element_blank(),  # Remove x-axis text
        axis.title.x = element_blank(), # Remove x-axis title
        axis.ticks.x = element_blank()) +
  scale_size_continuous(range = c(3, 15))

```

